<script type="text/javascript">
function fullcalBruker() {
    $('#calendarBruker').fullCalendar({
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            editable: true,
            displayEventEnd: true,
            eventLimit: true, // allow "more" link when too many events
            events: {
                url: '/api/VaktApi2/',
                type: 'GET',
                dataType: 'json',
                data: function () { // a function that returns an object
                    return {
                        id: $('#selectProsjekt').val(),
                    };

                },
                error: function () {
                    $('#feil').html("<div class='alert alert-warning alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><strong>Du er ikke medlem av noen jobber enda!</strong> Gå til <a href='/Prosjekt/Index' class='alert-link'>Jobb</a> for å legge til en jobb</div>");

                    $('#script-warning').show();
                }
            },

            loading: function (bool) {
                $('#loading').toggle(bool);
            },
            eventClick: function (event, jsEvent, view) {
                var start = event.start;
                var end = event.end;
                $('#modalTitle').html(event.title);
                $('#modalBody').html(event.title);
                if (event.Brukernavn == null) {
                    event.Brukernavn = "Ledig vakt";
                    $('#tavakt').html("<button id='" + event.VaktId + "' class='btn btn-primary btnTavakt'>Ta vakt</button>");
                }

                $('#modalBody').append(": " + event.Brukernavn);

                $('#modalBody').append(start.format(" HH:mm" + "-"));
                $('#modalBody').append(end.format("HH:mm"));

                $('#endrevakt').html("<button id='" + event.VaktId + "' class='btn btn-warning btnEndreVakt'>Endre vakt</button>");
                $('#slettvakt').html("<button id='" + event.VaktId + "' class='btn btn-danger btnSlettVakt'>Slett vakt</button>");
                $('#eventUrl').attr('href', event.url);
                $('#fullCalModal').modal();
                // $("#fullCalModal").html("");
                // change the border color just for fun
                $(this).css('border-color', 'red');


            }
        });

};
function selOnChange() {
    $('#selectProsjekt').on('change', function () {
     
        $('#calendarBruker').fullCalendar('refetchEvents');
    });
};
$(document).ready(function () {
    fullcalBruker();
    selOnChange();
});

</script>
<div class="row">
    <div class='col-sm-2'>
        <select class="form-control input-sm" id="selectProsjekt">
            @{Html.RenderAction("prosjektMeny", "Prosjekt");}
        </select>
    </div>
    <a class="btn btn-default btn-sm" href="/Vakt/MinVaktplan">Se mine vakter</a>
    <a class="btn btn-default btn-sm" href="/Vakt/Index">Alle Vakter</a>

    <div id="loading"></div>
</div>
<div id="calendarBruker"></div>